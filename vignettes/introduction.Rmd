---
title: "Getting Started with longorwide"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with longorwide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

The `longorwide` package provides comprehensive tools for data transformation and statistical analysis, with a focus on survey data and repeated measures designs. This vignette demonstrates the main features of the package.

## Installation

```{r eval=FALSE}
# Install from GitHub
devtools::install_github("LittleMonkeyLab/long_or_wide")
```

```{r setup}
library(longorwide)
```

## Data Transformation

### Wide to Long Format

Wide format has one row per subject with multiple columns for repeated measures:

```{r}
# Create example wide data
wide_data <- data.frame(
  subject_id = 1:5,
  age = c(22, 25, 23, 24, 26),
  pre_test = c(45, 52, 48, 50, 55),
  mid_test = c(50, 58, 52, 55, 60),
  post_test = c(58, 65, 60, 62, 68)
)

print(wide_data)
```

Convert to long format:

```{r}
long_data <- wide_to_long(
  wide_data,
  id_cols = c("subject_id", "age"),
  value_cols = c("pre_test", "mid_test", "post_test"),
  names_to = "timepoint",
  values_to = "test_score"
)

print(long_data)
```

### Long to Wide Format

Convert back to wide format:

```{r}
wide_again <- long_to_wide(
  long_data,
  id_cols = c("subject_id", "age"),
  names_from = "timepoint",
  values_from = "test_score"
)

print(wide_again)
```

## Qualtrics Data Workflow

### Importing and Cleaning

```{r}
# Simulated Qualtrics export structure
qualtrics_raw <- data.frame(
  ResponseId = c("ImportId", "Question text", "R_001", "R_002", "R_003"),
  Q1 = c("ImportId", "Rate your satisfaction", "5", "4", "3"),
  Q2 = c("ImportId", "Rate your experience", "4", "5", "4"),
  Q3 = c("ImportId", "Would recommend", "5", "5", "4"),
  stringsAsFactors = FALSE
)

# Prepare Qualtrics data (removes header rows)
clean_data <- prepare_qualtrics(qualtrics_raw, remove_first_rows = 2)
print(clean_data)
```

### Reverse Scoring

```{r}
# Simulate data with items on 1-5 scale
survey_data <- data.frame(
  id = 1:5,
  item1 = c(5, 4, 3, 4, 5),  # Regular item
  item2 = c(1, 2, 3, 2, 1),  # Reverse coded
  item3 = c(5, 5, 4, 5, 4),  # Regular item
  item4 = c(2, 1, 2, 1, 2)   # Reverse coded
)

# Reverse score items 2 and 4
survey_data_reversed <- reverse_score(
  survey_data,
  items = c("item2", "item4"),
  min_value = 1,
  max_value = 5
)

print(survey_data_reversed)
```

## Statistical Analyses

### T-Tests

#### Between-Subjects Design

```{r}
# Create example data
set.seed(123)
between_data <- data.frame(
  group = rep(c("Control", "Treatment"), each = 20),
  score = c(rnorm(20, mean = 50, sd = 10),
            rnorm(20, mean = 55, sd = 10))
)

# Run t-test
result <- run_ttest(
  between_data,
  design = "between",
  dv = "score",
  iv = "group"
)

print(result$result)
print(result$descriptives)
```

#### Within-Subjects Design

```{r}
# Create paired data
set.seed(123)
within_data <- data.frame(
  pre_test = rnorm(20, mean = 50, sd = 10),
  post_test = rnorm(20, mean = 55, sd = 10)
)

# Run paired t-test
result <- run_ttest(
  within_data,
  design = "within",
  group1 = "pre_test",
  group2 = "post_test"
)

print(result$result)
print(result$descriptives)
```

### ANOVA

#### One-Way ANOVA

```{r}
# Create example data with 3 groups
set.seed(123)
oneway_data <- data.frame(
  condition = rep(c("Control", "Treatment1", "Treatment2"), each = 20),
  performance = c(
    rnorm(20, mean = 50, sd = 10),
    rnorm(20, mean = 55, sd = 10),
    rnorm(20, mean = 60, sd = 10)
  )
)

# Run one-way ANOVA
result <- run_anova(
  oneway_data,
  design = "one_way",
  dv = "performance",
  iv1 = "condition"
)

print(result$anova_result)
print(paste("Eta squared:", round(result$eta_squared, 3)))
```

#### Two-Way ANOVA

```{r}
# Create example data with 2x2 design
set.seed(123)
twoway_data <- data.frame(
  factor1 = rep(c("A", "B"), each = 40),
  factor2 = rep(c("X", "Y"), 40),
  outcome = rnorm(80, mean = 50, sd = 10)
)

# Run two-way ANOVA
result <- run_anova(
  twoway_data,
  design = "two_way",
  dv = "outcome",
  iv1 = "factor1",
  iv2 = "factor2"
)

print(result$anova_result)
```

### Multiple Regression

```{r}
# Create example data
set.seed(123)
regression_data <- data.frame(
  outcome = rnorm(50, mean = 50, sd = 10),
  predictor1 = rnorm(50, mean = 10, sd = 2),
  predictor2 = rnorm(50, mean = 5, sd = 1),
  covariate = rnorm(50, mean = 30, sd = 5)
)

# Run multiple regression with covariates
result <- run_multiple_regression(
  regression_data,
  dv = "outcome",
  predictors = c("predictor1", "predictor2"),
  covariates = "covariate"
)

print(result$summary)
print("Hierarchical comparison:")
print(result$hierarchical_comparison)
```

## Utility Functions

### Checking Assumptions

```{r}
# Create example data
set.seed(123)
assumption_data <- data.frame(
  group = rep(c("A", "B", "C"), each = 30),
  score = c(
    rnorm(30, mean = 50, sd = 10),
    rnorm(30, mean = 55, sd = 10),
    rnorm(30, mean = 60, sd = 10)
  )
)

# Check assumptions
assumptions <- check_assumptions(
  assumption_data,
  dv = "score",
  group = "group"
)

print("Normality by group:")
print(assumptions$normality_by_group)

print("Homogeneity of variance:")
print(assumptions$homogeneity)
```

### Descriptive Statistics

```{r}
# Overall descriptives
desc_overall <- descriptive_stats(
  assumption_data,
  vars = "score"
)
print(desc_overall)

# Descriptives by group
desc_by_group <- descriptive_stats(
  assumption_data,
  vars = "score",
  group = "group"
)
print(desc_by_group)
```

### Cronbach's Alpha

```{r}
# Create scale data
set.seed(123)
scale_data <- data.frame(
  item1 = sample(1:5, 30, replace = TRUE),
  item2 = sample(1:5, 30, replace = TRUE),
  item3 = sample(1:5, 30, replace = TRUE),
  item4 = sample(1:5, 30, replace = TRUE),
  item5 = sample(1:5, 30, replace = TRUE)
)

# Calculate Cronbach's alpha
alpha_result <- cronbach_alpha(
  scale_data,
  items = c("item1", "item2", "item3", "item4", "item5")
)

print(paste("Cronbach's alpha:", round(alpha_result$alpha, 3)))
print(paste("Standardized alpha:", round(alpha_result$standardized_alpha, 3)))
print("Item statistics:")
print(alpha_result$item_statistics)
```

## Interactive Data Converter

Launch the Shiny app for interactive data conversion:

```{r eval=FALSE}
run_converter_app()
```

The app provides:
- File upload for CSV data
- Interactive conversion between wide and long formats
- Data preview (original and converted)
- R code generation for reproducibility
- Download converted data

## Complete Analysis Example

Here's a complete workflow from Qualtrics import to analysis:

```{r}
# 1. Simulate Qualtrics data
set.seed(123)
simulated_survey <- data.frame(
  ResponseId = paste0("R_", 1:50),
  condition = sample(c("Control", "Treatment"), 50, replace = TRUE),
  item1 = sample(1:7, 50, replace = TRUE),
  item2_rev = sample(1:7, 50, replace = TRUE),
  item3 = sample(1:7, 50, replace = TRUE),
  item4_rev = sample(1:7, 50, replace = TRUE),
  item5 = sample(1:7, 50, replace = TRUE)
)

# 2. Reverse score items
simulated_survey <- reverse_score(
  simulated_survey,
  items = c("item2_rev", "item4_rev"),
  min_value = 1,
  max_value = 7
)

# 3. Calculate scale score
simulated_survey$scale_score <- rowMeans(
  simulated_survey[, c("item1", "item2_rev", "item3", "item4_rev", "item5")],
  na.rm = TRUE
)

# 4. Check reliability
alpha <- cronbach_alpha(
  simulated_survey,
  items = c("item1", "item2_rev", "item3", "item4_rev", "item5")
)
print(paste("Scale reliability (alpha):", round(alpha$alpha, 3)))

# 5. Descriptive statistics
desc <- descriptive_stats(
  simulated_survey,
  vars = "scale_score",
  group = "condition"
)
print("Descriptive statistics by condition:")
print(desc)

# 6. Check assumptions
assumptions <- check_assumptions(
  simulated_survey,
  dv = "scale_score",
  group = "condition"
)
print("Assumption checks:")
print(assumptions)

# 7. Run statistical test
result <- run_ttest(
  simulated_survey,
  design = "between",
  dv = "scale_score",
  iv = "condition"
)
print("T-test results:")
print(result$result)
```

## Conclusion

The `longorwide` package provides a comprehensive toolkit for data transformation and statistical analysis, particularly suited for survey research and repeated measures designs. The package integrates well with Qualtrics workflows and provides both programmatic and interactive (Shiny) interfaces for data manipulation.
